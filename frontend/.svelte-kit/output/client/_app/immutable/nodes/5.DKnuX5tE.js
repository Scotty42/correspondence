import{f as m,a as u,t as Wt}from"../chunks/Dp-lm7Ug.js";import{o as Xt}from"../chunks/BvysEO2T.js";import{A as Yt,B as p,C as Et,D as te,e as ee,G as a,I as n,F as v,$ as ae,J as t,K as r,M as y,O as re,N as ne}from"../chunks/1DOnEbbI.js";import{d as ie,s as h,e as se}from"../chunks/DmiR870a.js";import{i as x}from"../chunks/CAGLYOiq.js";import{h as oe,c as le,e as Pt,r as N,i as qt,d as Nt}from"../chunks/BhBHE4xL.js";import{b as w}from"../chunks/B4BRPVhc.js";import{b as et}from"../chunks/GcPdi8XZ.js";import{g as ve}from"../chunks/xLTc4pET.js";var ue=m('<div class="alert alert-error"> </div>'),ce=m('<div class="alert alert-success"> </div>'),de=m('<div class="text-center mt-3"><span class="loading"></span></div>'),_e=m("<option> </option>"),pe=m('<button type="button" class="btn btn-danger btn-sm">×</button>'),me=m('<tr><td><input type="text" class="form-input" placeholder="Beschreibung"/></td><td><input type="number" class="form-input" min="0.01" step="0.01"/></td><td><select class="form-select"><option>Stück</option><option>Stunden</option><option>Tage</option><option>Pauschal</option><option>km</option></select></td><td><input type="number" class="form-input" min="0" step="0.01"/></td><td><select class="form-select"><option>19%</option><option>7%</option><option>0%</option></select></td><td class="text-right"> </td><td><!></td></tr>'),fe=m('<span class="loading"></span> Erstelle...',1),he=m('<form><div class="card mb-2"><h2 class="mb-2 svelte-1ox2861">Empfänger & Zahlungsziel</h2> <div class="grid grid-2"><div class="form-group"><label class="form-label">Empfänger *</label> <select class="form-select" required><option>-- Bitte wählen --</option><!></select></div> <div class="form-group"><label class="form-label">Zahlungsziel (Tage)</label> <input type="number" class="form-input" min="1" max="90"/></div></div></div> <div class="card mb-2"><div class="flex-between mb-2"><h2 class="svelte-1ox2861">Positionen</h2> <button type="button" class="btn btn-secondary btn-sm">+ Position</button></div> <table class="table"><thead><tr><th style="width: 40%">Beschreibung</th><th style="width: 10%">Menge</th><th style="width: 12%">Einheit</th><th style="width: 15%">Einzelpreis</th><th style="width: 10%">MwSt %</th><th style="width: 13%">Gesamt</th><th></th></tr></thead><tbody></tbody></table> <div class="totals mt-2 svelte-1ox2861"><div class="total-row svelte-1ox2861"><span>Netto:</span> <span> </span></div> <div class="total-row svelte-1ox2861"><span>MwSt:</span> <span> </span></div> <div class="total-row total-gross svelte-1ox2861"><span>Gesamt:</span> <span> </span></div></div></div> <div class="card mb-2"><h2 class="mb-2 svelte-1ox2861">Notizen (optional)</h2> <textarea class="form-textarea" rows="3" placeholder="Zusätzliche Hinweise auf der Rechnung..."></textarea></div> <button type="submit" class="btn btn-primary"><!></button></form>'),be=m('<div class="invoice-page"><div class="flex-between mb-3"><h1 class="svelte-1ox2861">Neue Rechnung</h1> <a href="/documents" class="btn btn-secondary">← Zurück</a></div> <!> <!> <!></div>');function Se(St,zt){Yt(zt,!0);let at=p(Et([])),rt=p(!0),k=p(!1),f=p(""),S=p(""),E=p(null),z=p(14),B=p(""),c=p(Et([{description:"",quantity:1,unit:"Stück",unit_price:0,vat_rate:19}]));Xt(async()=>{try{v(at,await le.list(),!0)}catch(e){v(f,e instanceof Error?e.message:"Fehler beim Laden der Kontakte",!0)}finally{v(rt,!1)}});function Bt(){v(c,[...t(c),{description:"",quantity:1,unit:"Stück",unit_price:0,vat_rate:19}],!0)}function Dt(e){v(c,t(c).filter((i,d)=>d!==e),!0)}function nt(){return t(c).reduce((e,i)=>e+i.quantity*i.unit_price,0)}function it(){return t(c).reduce((e,i)=>e+i.quantity*i.unit_price*i.vat_rate/100,0)}function Rt(){return nt()+it()}function P(e){return new Intl.NumberFormat("de-DE",{style:"currency",currency:"EUR"}).format(e)}async function Ft(){if(!t(E)){v(f,"Bitte wähle einen Empfänger");return}const e=t(c).filter(i=>i.description.trim()&&i.unit_price>0);if(e.length===0){v(f,"Bitte füge mindestens eine Position hinzu");return}v(k,!0),v(f,"");try{const i=await Nt.createInvoice({contact_id:t(E),positions:e,due_days:t(z),notes:t(B)||void 0});v(S,`Rechnung ${i.doc_number} wurde erstellt`),window.open(Nt.getPdfUrl(i.id),"_blank"),setTimeout(()=>ve("/documents"),1500)}catch(i){v(f,i instanceof Error?i.message:"Fehler beim Erstellen",!0)}finally{v(k,!1)}}function It(e){return e.company_name?e.company_name:[e.first_name,e.last_name].filter(Boolean).join(" ")||"Unbenannt"}var D=be();oe("1ox2861",e=>{ee(()=>{ae.title="Neue Rechnung - Korrespondenz"})});var st=a(n(D),2);{var Mt=e=>{var i=ue(),d=n(i,!0);r(i),y(()=>h(d,t(f))),u(e,i)};x(st,e=>{t(f)&&e(Mt)})}var ot=a(st,2);{var Ct=e=>{var i=ce(),d=n(i,!0);r(i),y(()=>h(d,t(S))),u(e,i)};x(ot,e=>{t(S)&&e(Ct)})}var Gt=a(ot,2);{var Tt=e=>{var i=de();u(e,i)},Zt=e=>{var i=he(),d=n(i),lt=a(n(d),2),R=n(lt),F=a(n(R),2),I=n(F);I.value=(I.__value=null)??"";var Kt=a(I);Pt(Kt,17,()=>t(at),qt,(o,s)=>{var _=_e(),g=n(_,!0);r(_);var b={};y(q=>{h(g,q),b!==(b=t(s).id)&&(_.value=(_.__value=t(s).id)??"")},[()=>It(t(s))]),u(o,_)}),r(F),r(R);var vt=a(R,2),ut=a(n(vt),2);N(ut),r(vt),r(lt),r(d);var M=a(d,2),C=n(M),Ut=a(n(C),2);Ut.__click=Bt,r(C);var G=a(C,2),ct=a(n(G));Pt(ct,21,()=>t(c),qt,(o,s,_)=>{var g=me(),b=n(g),q=n(b);N(q),r(b);var L=a(b),bt=n(L);N(bt),r(L);var j=a(L),A=n(j),H=n(A);H.value=H.__value="Stück";var J=a(H);J.value=J.__value="Stunden";var O=a(J);O.value=O.__value="Tage";var V=a(O);V.value=V.__value="Pauschal";var gt=a(V);gt.value=gt.__value="km",r(A),r(j);var $=a(j),yt=n($);N(yt),r($);var Q=a($),W=n(Q),X=n(W);X.value=X.__value=19;var Y=a(X);Y.value=Y.__value=7;var xt=a(Y);xt.value=xt.__value=0,r(W),r(Q);var tt=a(Q),Vt=n(tt,!0);r(tt);var wt=a(tt),$t=n(wt);{var Qt=l=>{var kt=pe();kt.__click=()=>Dt(_),u(l,kt)};x($t,l=>{t(c).length>1&&l(Qt)})}r(wt),r(g),y(l=>h(Vt,l),[()=>P(t(s).quantity*t(s).unit_price)]),w(q,()=>t(s).description,l=>t(s).description=l),w(bt,()=>t(s).quantity,l=>t(s).quantity=l),et(A,()=>t(s).unit,l=>t(s).unit=l),w(yt,()=>t(s).unit_price,l=>t(s).unit_price=l),et(W,()=>t(s).vat_rate,l=>t(s).vat_rate=l),u(o,g)}),r(ct),r(G);var dt=a(G,2),T=n(dt),_t=a(n(T),2),Lt=n(_t,!0);r(_t),r(T);var Z=a(T,2),pt=a(n(Z),2),jt=n(pt,!0);r(pt),r(Z);var mt=a(Z,2),ft=a(n(mt),2),At=n(ft,!0);r(ft),r(mt),r(dt),r(M);var K=a(M,2),ht=a(n(K),2);re(ht),r(K);var U=a(K,2),Ht=n(U);{var Jt=o=>{var s=fe();ne(),u(o,s)},Ot=o=>{var s=Wt("Rechnung erstellen & PDF öffnen");u(o,s)};x(Ht,o=>{t(k)?o(Jt):o(Ot,!1)})}r(U),r(i),y((o,s,_)=>{h(Lt,o),h(jt,s),h(At,_),U.disabled=t(k)},[()=>P(nt()),()=>P(it()),()=>P(Rt())]),se("submit",i,o=>{o.preventDefault(),Ft()}),et(F,()=>t(E),o=>v(E,o)),w(ut,()=>t(z),o=>v(z,o)),w(ht,()=>t(B),o=>v(B,o)),u(e,i)};x(Gt,e=>{t(rt)?e(Tt):e(Zt,!1)})}r(D),u(St,D),te()}ie(["click"]);export{Se as component};
