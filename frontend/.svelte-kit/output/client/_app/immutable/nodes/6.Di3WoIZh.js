import{f as u,a as o,t as z}from"../chunks/Dp-lm7Ug.js";import{o as Ye}from"../chunks/BvysEO2T.js";import{A as Ke,B as f,C as Pe,D as Me,e as Le,G as s,I as i,F as r,$ as Ce,J as a,K as n,M as x,O as se,N as re}from"../chunks/1DOnEbbI.js";import{d as je,s as y,e as qe}from"../chunks/DmiR870a.js";import{i as m}from"../chunks/CAGLYOiq.js";import{h as Oe,c as Re,e as Ue,i as Je,r as Se,b as Ve,d as le}from"../chunks/BhBHE4xL.js";import{s as ie}from"../chunks/CJvCuKPs.js";import{b as q}from"../chunks/B4BRPVhc.js";import{b as Ze}from"../chunks/GcPdi8XZ.js";import{g as $e}from"../chunks/xLTc4pET.js";var He=u('<div class="alert alert-error"> </div>'),Qe=u('<div class="alert alert-success"> </div>'),We=u('<div class="text-center mt-3"><span class="loading"></span></div>'),et=u("<option> </option>"),tt=u('<div class="mt-1"><a href="/contacts" class="text-muted">Erst Kontakt anlegen ‚Üí</a></div>'),at=u('<span class="loading"></span> Erstelle...',1),st=u('<span class="loading"></span> Generiere...',1),rt=u('<ul class="svelte-1ak960k"><li class="svelte-1ak960k">Absender: <strong>Ingenieurb√ºro Dr.-Ing. Friedrich</strong></li> <li class="svelte-1ak960k">Mit Gesch√§ftsdaten in der Fu√üzeile</li> <li class="svelte-1ak960k">Aktenzeichen/Dokumentennummer wird angezeigt</li> <li class="svelte-1ak960k">Nummernkreis: BRF-YYYY-XXXX</li></ul>'),lt=u('<ul class="svelte-1ak960k"><li class="svelte-1ak960k">Absender: <strong>Dr.-Ing. Markus Friedrich</strong> (privat)</li> <li class="svelte-1ak960k">Minimale Fu√üzeile</li> <li class="svelte-1ak960k">Ohne Aktenzeichen</li> <li class="svelte-1ak960k">Nummernkreis: PRV-YYYY-XXXX</li></ul>'),it=u('<div class="grid" style="grid-template-columns: 1fr 1fr; gap: 1.5rem;"><div class="card"><h2 class="mb-2 svelte-1ak960k">Brief erstellen</h2> <form><div class="form-group"><label class="form-label">Brieftyp</label> <div class="letter-type-selector svelte-1ak960k"><button type="button"><span class="type-icon svelte-1ak960k">üè¢</span> <span class="type-label svelte-1ak960k">Gesch√§ftsbrief</span> <span class="type-desc svelte-1ak960k">Mit Firmenname & Gesch√§ftsdaten</span></button> <button type="button"><span class="type-icon svelte-1ak960k">üë§</span> <span class="type-label svelte-1ak960k">Privatbrief</span> <span class="type-desc svelte-1ak960k">Nur pers√∂nlicher Name</span></button></div></div> <div class="form-group"><label class="form-label">Empf√§nger *</label> <select class="form-select" required><option>-- Bitte w√§hlen --</option><!></select> <!></div> <div class="form-group"><label class="form-label">Betreff *</label> <input type="text" class="form-input" required placeholder="z.B. Anfrage zu Ihrem Angebot"/></div> <div class="form-group"><label class="form-label">Inhalt *</label> <textarea class="form-textarea" required rows="12" placeholder="Brieftext (ohne Anrede und Gru√üformel - diese werden automatisch erg√§nzt)"></textarea></div> <div class="flex gap-1"><button type="submit" class="btn btn-primary"><!></button></div></form></div> <div class="card"><h2 class="mb-2 svelte-1ak960k">ü§ñ KI-Assistent</h2> <p class="text-muted mb-2">Beschreibe dein Anliegen und lass dir einen Textentwurf generieren.</p> <div class="form-group"><label class="form-label">Anliegen beschreiben</label> <textarea class="form-textarea" rows="4" placeholder="z.B. Absage eines Termins wegen Krankheit, Nachfrage zum Status einer Bestellung, Beschwerde √ºber versp√§tete Lieferung..."></textarea></div> <button type="button" class="btn btn-secondary"><!></button> <div class="ai-hint mt-2 svelte-1ak960k"><strong>Tipp:</strong> Der generierte Text wird im Inhaltsfeld eingef√ºgt. <!></div> <div class="info-box mt-3 svelte-1ak960k"><h3 class="svelte-1ak960k"> </h3> <!></div></div></div>'),nt=u('<div class="letter-page"><div class="flex-between mb-3"><h1 class="svelte-1ak960k">Neuer Brief</h1> <a href="/documents" class="btn btn-secondary">‚Üê Zur√ºck</a></div> <!> <!> <!></div>');function kt(ne,oe){Ke(oe,!0);let G=f(Pe([])),O=f(!0),w=f(!1),B=f(!1),d=f(""),I=f(""),c=f("business"),b=f(null),A=f(""),_=f(""),k=f("");Ye(async()=>{try{r(G,await Re.list(),!0)}catch(t){r(d,t instanceof Error?t.message:"Fehler beim Laden der Kontakte",!0)}finally{r(O,!1)}});async function ve(){if(!a(k).trim()){r(d,"Bitte beschreibe das Anliegen f√ºr die KI");return}r(B,!0),r(d,"");try{const t=await Ve.generateDraft({doc_type:"letter",context:a(k),tone:a(c)==="business"?"formal":"friendly",letter_type:a(c),contact_id:a(b)||void 0});r(_,t.text,!0)}catch(t){r(d,t instanceof Error?t.message:"Fehler bei der Textgenerierung",!0)}finally{r(B,!1)}}async function ce(){if(!a(b)){r(d,"Bitte w√§hle einen Empf√§nger");return}if(!a(A).trim()){r(d,"Bitte gib einen Betreff ein");return}if(!a(_).trim()){r(d,"Bitte gib den Briefinhalt ein");return}r(w,!0),r(d,"");try{const t=await le.createLetter({contact_id:a(b),subject:a(A),content:a(_),letter_type:a(c)});r(I,`${a(c)==="business"?"Gesch√§ftsbrief":"Privatbrief"} ${t.doc_number} wurde erstellt`),window.open(le.getPdfUrl(t.id),"_blank"),setTimeout(()=>$e("/documents"),1500)}catch(t){r(d,t instanceof Error?t.message:"Fehler beim Erstellen",!0)}finally{r(w,!1)}}function de(t){return t.company_name?t.first_name?`${t.company_name} (${t.first_name} ${t.last_name})`:t.company_name:[t.first_name,t.last_name].filter(Boolean).join(" ")||"Unbenannt"}var T=nt();Oe("1ak960k",t=>{Le(()=>{Ce.title="Neuer Brief - Korrespondenz"})});var R=s(i(T),2);{var fe=t=>{var v=He(),p=i(v,!0);n(v),x(()=>y(p,a(d))),o(t,v)};m(R,t=>{a(d)&&t(fe)})}var U=s(R,2);{var ue=t=>{var v=Qe(),p=i(v,!0);n(v),x(()=>y(p,a(I))),o(t,v)};m(U,t=>{a(I)&&t(ue)})}var me=s(U,2);{var pe=t=>{var v=We();o(t,v)},be=t=>{var v=it(),p=i(v),D=s(i(p),2),N=i(D),J=s(i(N),2),E=i(J);let S;E.__click=()=>r(c,"business");var V=s(E,2);let Z;V.__click=()=>r(c,"private"),n(J),n(N);var X=s(N,2),F=s(i(X),2),Y=i(F);Y.value=(Y.__value=null)??"";var _e=s(Y);Ue(_e,17,()=>a(G),Je,(e,l)=>{var h=et(),Ee=i(h,!0);n(h);var ae={};x(Xe=>{y(Ee,Xe),ae!==(ae=a(l).id)&&(h.value=(h.__value=a(l).id)??"")},[()=>de(a(l))]),o(e,h)}),n(F);var ke=s(F,2);{var ge=e=>{var l=tt();o(e,l)};m(ke,e=>{a(G).length===0&&e(ge)})}n(X);var K=s(X,2),$=s(i(K),2);Se($),n(K);var P=s(K,2),H=s(i(P),2);se(H),n(P);var Q=s(P,2),M=i(Q),he=i(M);{var xe=e=>{var l=at();re(),o(e,l)},ye=e=>{var l=z();x(()=>y(l,`${a(c)==="business"?"Gesch√§ftsbrief":"Privatbrief"} erstellen`)),o(e,l)};m(he,e=>{a(w)?e(xe):e(ye,!1)})}n(M),n(Q),n(D),n(p);var W=s(p,2),L=s(i(W),4),ee=s(i(L),2);se(ee),n(L);var g=s(L,2);g.__click=ve;var we=i(g);{var Be=e=>{var l=st();re(),o(e,l)},Ae=e=>{var l=z("‚ú® Text generieren");o(e,l)};m(we,e=>{a(B)?e(Be):e(Ae,!1)})}n(g);var C=s(g,2),Fe=s(i(C),2);{var ze=e=>{var l=z("F√ºr Gesch√§ftsbriefe wird ein formeller Ton verwendet.");o(e,l)},Ge=e=>{var l=z("F√ºr Privatbriefe wird ein freundlicherer Ton verwendet.");o(e,l)};m(Fe,e=>{a(c)==="business"?e(ze):e(Ge,!1)})}n(C);var te=s(C,2),j=i(te),Ie=i(j);n(j);var Te=s(j,2);{var De=e=>{var l=rt();o(e,l)},Ne=e=>{var l=lt();o(e,l)};m(Te,e=>{a(c)==="business"?e(De):e(Ne,!1)})}n(te),n(W),n(v),x(e=>{S=ie(E,1,"type-btn svelte-1ak960k",null,S,{active:a(c)==="business"}),Z=ie(V,1,"type-btn svelte-1ak960k",null,Z,{active:a(c)==="private"}),M.disabled=a(w),g.disabled=e,y(Ie,`üìã ${a(c)==="business"?"Gesch√§ftsbrief":"Privatbrief"}`)},[()=>a(B)||!a(k).trim()]),qe("submit",D,e=>{e.preventDefault(),ce()}),Ze(F,()=>a(b),e=>r(b,e)),q($,()=>a(A),e=>r(A,e)),q(H,()=>a(_),e=>r(_,e)),q(ee,()=>a(k),e=>r(k,e)),o(t,v)};m(me,t=>{a(O)?t(pe):t(be,!1)})}n(T),o(ne,T),Me()}je(["click"]);export{kt as component};
