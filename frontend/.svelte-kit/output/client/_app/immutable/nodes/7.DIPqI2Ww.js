import{f as _,a as c,t as Mt}from"../chunks/Dp-lm7Ug.js";import{o as he}from"../chunks/BvysEO2T.js";import{A as ye,B as d,C as Ot,D as xe,e as we,G as a,I as r,F as l,$ as ke,J as t,K as e,M as E,O as jt,N as Ut}from"../chunks/1DOnEbbI.js";import{d as Be,s as h,e as Ee}from"../chunks/DmiR870a.js";import{i as x}from"../chunks/CAGLYOiq.js";import{h as Ae,c as Pe,e as Lt,i as Zt,r as w,b as qe,d as Jt}from"../chunks/BhBHE4xL.js";import{b}from"../chunks/B4BRPVhc.js";import{b as dt}from"../chunks/GcPdi8XZ.js";import{g as De}from"../chunks/xLTc4pET.js";var ze=_('<div class="alert alert-error"> </div>'),Ne=_('<div class="alert alert-success"> </div>'),Se=_('<div class="text-center mt-3"><span class="loading"></span></div>'),Ie=_("<option> </option>"),Te=_('<button type="button" class="btn btn-danger btn-sm">√ó</button>'),Fe=_('<tr><td><input type="text" class="form-input" placeholder="Beschreibung"/></td><td><input type="number" class="form-input" min="0.01" step="0.01"/></td><td><select class="form-select"><option>St√ºck</option><option>Stunden</option><option>Tage</option><option>Pauschal</option><option>km</option></select></td><td><input type="number" class="form-input" min="0" step="0.01"/></td><td><select class="form-select"><option>19%</option><option>7%</option><option>0%</option></select></td><td class="text-right"> </td><td><!></td></tr>'),Ge=_('<span class="loading"></span> Generiere...',1),Ce=_('<span class="loading"></span> Erstelle...',1),Ke=_('<form><div class="card mb-2"><h2 class="mb-2 svelte-1c74fs0">Angebots-Details</h2> <div class="grid grid-2"><div class="form-group"><label class="form-label">Empf√§nger *</label> <select class="form-select" required><option>-- Bitte w√§hlen --</option><!></select></div> <div class="form-group"><label class="form-label">Betreff *</label> <input type="text" class="form-input" required placeholder="z.B. IT-Beratung Digitalisierung"/></div></div> <div class="grid grid-2"><div class="form-group"><label class="form-label">G√ºltigkeit (Tage)</label> <input type="number" class="form-input" min="1" max="365"/></div> <div class="form-group"><label class="form-label">Anzahlung (%)</label> <input type="number" class="form-input" min="0" max="100" placeholder="Optional"/></div></div></div> <div class="card mb-2"><div class="flex-between mb-2"><h2 class="svelte-1c74fs0">Positionen</h2> <button type="button" class="btn btn-secondary btn-sm">+ Position</button></div> <table class="table"><thead><tr><th style="width: 40%">Beschreibung</th><th style="width: 10%">Menge</th><th style="width: 12%">Einheit</th><th style="width: 15%">Einzelpreis</th><th style="width: 10%">MwSt %</th><th style="width: 13%">Gesamt</th><th></th></tr></thead><tbody></tbody></table> <div class="totals mt-2 svelte-1c74fs0"><div class="total-row svelte-1c74fs0"><span>Netto:</span> <span> </span></div> <div class="total-row svelte-1c74fs0"><span>MwSt:</span> <span> </span></div> <div class="total-row total-gross svelte-1c74fs0"><span>Gesamt:</span> <span> </span></div></div></div> <div class="grid" style="grid-template-columns: 1fr 1fr; gap: 1rem;"><div class="card"><h2 class="mb-2 svelte-1c74fs0">Notizen / Einleitung</h2> <textarea class="form-textarea" rows="5" placeholder="Zus√§tzlicher Text im Angebot..."></textarea></div> <div class="card"><h2 class="mb-2 svelte-1c74fs0">ü§ñ KI-Assistent</h2> <div class="form-group"><textarea class="form-textarea" rows="3" placeholder="Beschreibe das Angebot kurz..."></textarea></div> <button type="button" class="btn btn-secondary"><!></button></div></div> <div class="mt-2"><button type="submit" class="btn btn-primary"><!></button></div></form>'),Me=_('<div class="offer-page"><div class="flex-between mb-3"><h1 class="svelte-1c74fs0">Neues Angebot</h1> <a href="/documents" class="btn btn-secondary">‚Üê Zur√ºck</a></div> <!> <!> <!></div>');function Qe(Rt,Vt){ye(Vt,!0);let ct=d(Ot([])),ut=d(!0),A=d(!1),P=d(!1),u=d(""),I=d(""),k=d(null),q=d(""),T=d(30),F=d(null),D=d(""),p=d(Ot([{description:"",quantity:1,unit:"St√ºck",unit_price:0,vat_rate:19}])),B=d("");he(async()=>{try{l(ct,await Pe.list(),!0)}catch(i){l(u,i instanceof Error?i.message:"Fehler beim Laden der Kontakte",!0)}finally{l(ut,!1)}});function Ht(){l(p,[...t(p),{description:"",quantity:1,unit:"St√ºck",unit_price:0,vat_rate:19}],!0)}function Qt(i){l(p,t(p).filter((s,f)=>f!==i),!0)}function _t(){return t(p).reduce((i,s)=>i+s.quantity*s.unit_price,0)}function pt(){return t(p).reduce((i,s)=>i+s.quantity*s.unit_price*s.vat_rate/100,0)}function Wt(){return _t()+pt()}function z(i){return new Intl.NumberFormat("de-DE",{style:"currency",currency:"EUR"}).format(i)}async function Xt(){if(!t(B).trim()){l(u,"Bitte beschreibe das Angebot f√ºr die KI");return}l(P,!0),l(u,"");try{const i=await qe.generateDraft({doc_type:"offer_intro",context:t(B),contact_id:t(k)||void 0});l(D,i.text,!0)}catch(i){l(u,i instanceof Error?i.message:"Fehler bei der Textgenerierung",!0)}finally{l(P,!1)}}async function Yt(){if(!t(k)){l(u,"Bitte w√§hle einen Empf√§nger");return}if(!t(q).trim()){l(u,"Bitte gib einen Betreff ein");return}const i=t(p).filter(s=>s.description.trim()&&s.unit_price>0);if(i.length===0){l(u,"Bitte f√ºge mindestens eine Position hinzu");return}l(A,!0),l(u,"");try{const s=await Jt.createOffer({contact_id:t(k),subject:t(q),positions:i,valid_days:t(T),prepayment_percent:t(F)||void 0,notes:t(D)||void 0});l(I,`Angebot ${s.doc_number} wurde erstellt`),window.open(Jt.getPdfUrl(s.id),"_blank"),setTimeout(()=>De("/documents"),1500)}catch(s){l(u,s instanceof Error?s.message:"Fehler beim Erstellen",!0)}finally{l(A,!1)}}function $t(i){return i.company_name?i.company_name:[i.first_name,i.last_name].filter(Boolean).join(" ")||"Unbenannt"}var G=Me();Ae("1c74fs0",i=>{we(()=>{ke.title="Neues Angebot - Korrespondenz"})});var ft=a(r(G),2);{var te=i=>{var s=ze(),f=r(s,!0);e(s),E(()=>h(f,t(u))),c(i,s)};x(ft,i=>{t(u)&&i(te)})}var mt=a(ft,2);{var ee=i=>{var s=Ne(),f=r(s,!0);e(s),E(()=>h(f,t(I))),c(i,s)};x(mt,i=>{t(I)&&i(ee)})}var ae=a(mt,2);{var re=i=>{var s=Se();c(i,s)},ie=i=>{var s=Ke(),f=r(s),C=a(r(f),2),K=r(C),M=a(r(K),2),O=r(M);O.value=(O.__value=null)??"";var ne=a(O);Lt(ne,17,()=>t(ct),Zt,(n,o)=>{var m=Ie(),g=r(m,!0);e(m);var y={};E(S=>{h(g,S),y!==(y=t(o).id)&&(m.value=(m.__value=t(o).id)??"")},[()=>$t(t(o))]),c(n,m)}),e(M),e(K);var bt=a(K,2),gt=a(r(bt),2);w(gt),e(bt),e(C);var ht=a(C,2),j=r(ht),yt=a(r(j),2);w(yt),e(j);var xt=a(j,2),wt=a(r(xt),2);w(wt),e(xt),e(ht),e(f);var U=a(f,2),L=r(U),se=a(r(L),2);se.__click=Ht,e(L);var Z=a(L,2),kt=a(r(Z));Lt(kt,21,()=>t(p),Zt,(n,o,m)=>{var g=Fe(),y=r(g),S=r(y);w(S),e(y);var X=a(y),It=r(X);w(It),e(X);var Y=a(X),$=r(Y),tt=r($);tt.value=tt.__value="St√ºck";var et=a(tt);et.value=et.__value="Stunden";var at=a(et);at.value=at.__value="Tage";var rt=a(at);rt.value=rt.__value="Pauschal";var Tt=a(rt);Tt.value=Tt.__value="km",e($),e(Y);var it=a(Y),Ft=r(it);w(Ft),e(it);var nt=a(it),st=r(nt),ot=r(st);ot.value=ot.__value=19;var lt=a(ot);lt.value=lt.__value=7;var Gt=a(lt);Gt.value=Gt.__value=0,e(st),e(nt);var vt=a(nt),me=r(vt,!0);e(vt);var Ct=a(vt),be=r(Ct);{var ge=v=>{var Kt=Te();Kt.__click=()=>Qt(m),c(v,Kt)};x(be,v=>{t(p).length>1&&v(ge)})}e(Ct),e(g),E(v=>h(me,v),[()=>z(t(o).quantity*t(o).unit_price)]),b(S,()=>t(o).description,v=>t(o).description=v),b(It,()=>t(o).quantity,v=>t(o).quantity=v),dt($,()=>t(o).unit,v=>t(o).unit=v),b(Ft,()=>t(o).unit_price,v=>t(o).unit_price=v),dt(st,()=>t(o).vat_rate,v=>t(o).vat_rate=v),c(n,g)}),e(kt),e(Z);var Bt=a(Z,2),J=r(Bt),Et=a(r(J),2),oe=r(Et,!0);e(Et),e(J);var R=a(J,2),At=a(r(R),2),le=r(At,!0);e(At),e(R);var Pt=a(R,2),qt=a(r(Pt),2),ve=r(qt,!0);e(qt),e(Pt),e(Bt),e(U);var V=a(U,2),H=r(V),Dt=a(r(H),2);jt(Dt),e(H);var zt=a(H,2),Q=a(r(zt),2),Nt=r(Q);jt(Nt),e(Q);var N=a(Q,2);N.__click=Xt;var de=r(N);{var ce=n=>{var o=Ge();Ut(),c(n,o)},ue=n=>{var o=Mt("‚ú® Einleitung generieren");c(n,o)};x(de,n=>{t(P)?n(ce):n(ue,!1)})}e(N),e(zt),e(V);var St=a(V,2),W=r(St),_e=r(W);{var pe=n=>{var o=Ce();Ut(),c(n,o)},fe=n=>{var o=Mt("Angebot erstellen & PDF √∂ffnen");c(n,o)};x(_e,n=>{t(A)?n(pe):n(fe,!1)})}e(W),e(St),e(s),E((n,o,m,g)=>{h(oe,n),h(le,o),h(ve,m),N.disabled=g,W.disabled=t(A)},[()=>z(_t()),()=>z(pt()),()=>z(Wt()),()=>t(P)||!t(B).trim()]),Ee("submit",s,n=>{n.preventDefault(),Yt()}),dt(M,()=>t(k),n=>l(k,n)),b(gt,()=>t(q),n=>l(q,n)),b(yt,()=>t(T),n=>l(T,n)),b(wt,()=>t(F),n=>l(F,n)),b(Dt,()=>t(D),n=>l(D,n)),b(Nt,()=>t(B),n=>l(B,n)),c(i,s)};x(ae,i=>{t(ut)?i(re):i(ie,!1)})}e(G),c(Rt,G),xe()}Be(["click"]);export{Qe as component};
